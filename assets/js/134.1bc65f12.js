(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{1371:function(t,a,s){"use strict";s.r(a);var n=s(10),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("strong",[t._v("什么是跨域？")])]),t._v(" "),s("ul",[s("li",[t._v("概念如下：只要协议、域名、端口有任何一个不同，都被当作是不同的域")])]),t._v(" "),s("p",[s("strong",[t._v("下面是具体的跨域情况详解")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("URL")]),t._v(" "),s("th",[t._v("说明")]),t._v(" "),s("th",[t._v("是否允许通信")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("http://www.a.com/a.js、http://www.a.com/b.js")]),t._v(" "),s("td",[t._v("同一域名下")]),t._v(" "),s("td",[t._v("允许")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com/lab/a.js、http://www.a.com/script/b.js")]),t._v(" "),s("td",[t._v("同一域名下不同文件夹")]),t._v(" "),s("td",[t._v("允许")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com:8000/a.js、http://www.a.com/b.js")]),t._v(" "),s("td",[t._v("同一域名，不同端口")]),t._v(" "),s("td",[t._v("不允许")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com/a.js、https://www.a.com/b.js")]),t._v(" "),s("td",[t._v("同一域名，不同协议")]),t._v(" "),s("td",[t._v("不允许")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com/a.js、http://70.32.92.74/b.js")]),t._v(" "),s("td",[t._v("域名和域名对应ip")]),t._v(" "),s("td",[t._v("不允许")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com/a.js、http://script.a.com/b.js")]),t._v(" "),s("td",[t._v("主域相同，子域不同")]),t._v(" "),s("td",[t._v("不允许（cookie这种情况下也不允许访问）")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.a.com/a.js、http://a.com/b.js")]),t._v(" "),s("td",[t._v("同一域名，不同二级域名（同上）")]),t._v(" "),s("td",[t._v("不允许（cookie这种情况下也不允许访问）")])]),t._v(" "),s("tr",[s("td",[t._v("http://www.cnblogs.com/a.js、http://www.a.com/b.js")]),t._v(" "),s("td",[t._v("不同域名")]),t._v(" "),s("td",[t._v("不允许")])])])]),t._v(" "),s("h2",{attrs:{id:"一、document-domain跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、document-domain跨域"}},[t._v("#")]),t._v(" 一、document.domain跨域")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理：相同主域名不同子域名下的页面，可以设置"),s("code",[t._v("document.domain")]),t._v("让它们同域")]),t._v(" "),s("li",[t._v("限制：同域"),s("code",[t._v("document")]),t._v("提供的是页面间的互操作，需要载入"),s("code",[t._v("iframe")]),t._v("页面")])]),t._v(" "),s("blockquote",[s("p",[t._v("下面几个域名下的页面都是可以通过"),s("code",[t._v("document.domain")]),t._v("跨域互操作的： "),s("code",[t._v("http://a.com/foo")]),t._v(", "),s("code",[t._v("http://b.a.com/bar")]),t._v(", "),s("code",[t._v("http://c.a.com/bar")]),t._v("。 但只能以页面嵌套的方式来进行页面互操作，比如常见的"),s("code",[t._v("iframe")]),t._v("方式就可以完成页面嵌套")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL http://a.com/foo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ifr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.a.com/bar'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ifrdoc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentDocument "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" ifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    ifrdoc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("上述代码所在的"),s("code",[t._v("URL")]),t._v("是"),s("code",[t._v("http://a.com/foo")]),t._v("，它对"),s("code",[t._v("http://b.a.com/bar")]),t._v("的"),s("code",[t._v("DOM")]),t._v("访问要求后者将 "),s("code",[t._v("document.domain")]),t._v("往上设置一级")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL http://b.a.com/bar")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a.com'")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("document.domain")]),t._v("只能从子域设置到主域，往下设置以及往其他域名设置都是不允许的， 在"),s("code",[t._v("Chrome")]),t._v("中给出的错误是这样的")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("Uncaught DOMException"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Failed to "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" the "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'domain'")]),t._v(" property on "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Document'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'baidu.com'")]),t._v(" is not a suffix "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b.a.com'")]),t._v("\n")])])]),s("h2",{attrs:{id:"二、有src的标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、有src的标签"}},[t._v("#")]),t._v(" 二、有src的标签")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理：所有具有"),s("code",[t._v("src")]),t._v("属性的"),s("code",[t._v("HTML")]),t._v("标签都是可以跨域的，包括"),s("code",[t._v("<img>")]),t._v(", "),s("code",[t._v("<script>")])]),t._v(" "),s("li",[t._v("限制：需要创建一个"),s("code",[t._v("DOM")]),t._v("对象，只能用于"),s("code",[t._v("GET")]),t._v("方法")])]),t._v(" "),s("blockquote",[s("ul",[s("li",[t._v("在"),s("code",[t._v("document.body")]),t._v("中"),s("code",[t._v("append")]),t._v("一个具有"),s("code",[t._v("src")]),t._v("属性的"),s("code",[t._v("HTML")]),t._v("标签， "),s("code",[t._v("src")]),t._v("属性值指向的"),s("code",[t._v("URL")]),t._v("会以"),s("code",[t._v("GET")]),t._v("方法被访问，该访问是可以跨域的")]),t._v(" "),s("li",[t._v("其实样式表的"),s("code",[t._v("<link>")]),t._v("标签也是可以跨域的，只要是有"),s("code",[t._v("src")]),t._v("或"),s("code",[t._v("href")]),t._v("的"),s("code",[t._v("HTML")]),t._v("标签都有跨域的能力")])])]),t._v(" "),s("ul",[s("li",[t._v("不同的"),s("code",[t._v("HTML")]),t._v("标签发送"),s("code",[t._v("HTTP")]),t._v("请求的时机不同，例如"),s("code",[t._v("<img>")]),t._v("在更改"),s("code",[t._v("src")]),t._v("属性时就会发送请求，而"),s("code",[t._v("script")]),t._v(", "),s("code",[t._v("iframe")]),t._v(", "),s("code",[t._v("link[rel=stylesheet]")]),t._v("只有在添加到"),s("code",[t._v("DOM")]),t._v("树之后才会发送"),s("code",[t._v("HTTP")]),t._v("请求：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" img "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nimg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://some/picture'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送HTTP请求")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ifr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<iframe>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("src"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.a.com/bar'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ifr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送HTTP请求")]),t._v("\n")])])]),s("h2",{attrs:{id:"三、jsonp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、jsonp"}},[t._v("#")]),t._v(" 三、JSONP")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理："),s("code",[t._v("<script>")]),t._v("是可以跨域的，而且在跨域脚本中可以直接回调当前脚本的函数")]),t._v(" "),s("li",[t._v("限制：需要创建一个"),s("code",[t._v("DOM")]),t._v("对象并且添加到"),s("code",[t._v("DOM")]),t._v("树，只能用于"),s("code",[t._v("GET")]),t._v("方法")])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("JSONP")]),t._v("利用的是"),s("code",[t._v("<script>")]),t._v("可以跨域的特性，跨域"),s("code",[t._v("URL")]),t._v("返回的脚本不仅包含数据，还包含一个回调")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL: http://b.a.com/foo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    foo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    bar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("然后在我们在主站"),s("code",[t._v("http://a.com")]),t._v("中，可以这样来跨域获取"),s("code",[t._v("http://b.a.com")]),t._v("的数据：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL: http://a.com/foo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("callback")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理跨域请求得到的数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<script>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("src"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.a.com/bar'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("其实"),s("code",[t._v("jQuery")]),t._v("已经封装了"),s("code",[t._v("JSONP")]),t._v("的使用，我们可以这样来")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getJSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://b.a.com/bar?callback=callback"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理跨域请求得到的数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[s("code",[t._v("$.getJSON")]),t._v("与"),s("code",[t._v("$.get")]),t._v("的区别是前者会把"),s("code",[t._v("responseText")]),t._v("转换为"),s("code",[t._v("JSON")]),t._v("，而且当"),s("code",[t._v("URL")]),t._v("具有"),s("code",[t._v("callback")]),t._v("参数时， "),s("code",[t._v("jQuery")]),t._v("将会把它解释为一个"),s("code",[t._v("JSONP")]),t._v("请求，创建一个"),s("code",[t._v("<script>")]),t._v("标签来完成该请求")])]),t._v(" "),s("h2",{attrs:{id:"四、navigation-对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、navigation-对象"}},[t._v("#")]),t._v(" 四、navigation 对象")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理："),s("code",[t._v("iframe")]),t._v("之间是共享"),s("code",[t._v("navigator")]),t._v("对象的，用它来传递信息")]),t._v(" "),s("li",[t._v("要求："),s("code",[t._v("IE6/7")])])]),t._v(" "),s("blockquote",[s("p",[t._v("有些人注意到了"),s("code",[t._v("IE6/7")]),t._v("的一个漏洞："),s("code",[t._v("iframe")]),t._v("之间的"),s("code",[t._v("window.navigator")]),t._v("对象是共享的。 我们可以把它作为一个"),s("code",[t._v("Messenger")]),t._v("，通过它来传递信息。比如一个简单的委托：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.com")]),t._v("\nnavigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据到达的处理函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" navigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" navigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b.com")]),t._v("\nnavigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getData")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/under/b.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" navigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" navigation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("与"),s("code",[t._v("document.navigator")]),t._v("类似，"),s("code",[t._v("window.name")]),t._v("也是当前窗口所有页面所共享的。也可以用它来传递信息。 同样蛋疼的办法还有传递"),s("code",[t._v("Hash")]),t._v("（有些人叫锚点），这是因为每次浏览器打开一个"),s("code",[t._v("URL")]),t._v("时，"),s("code",[t._v("URL")]),t._v("后面的"),s("code",[t._v("#xxx")]),t._v("部分会保留下来，那么新的页面可以从这里获得上一个页面的数据")])]),t._v(" "),s("h2",{attrs:{id:"五、跨域资源共享（cors）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、跨域资源共享（cors）"}},[t._v("#")]),t._v(" 五、跨域资源共享（CORS）")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理：服务器设置"),s("code",[t._v("Access-Control-Allow-OriginHTTP")]),t._v("响应头之后，浏览器将会允许跨域请求")]),t._v(" "),s("li",[t._v("限制：浏览器需要支持"),s("code",[t._v("HTML5")]),t._v("，可以支持"),s("code",[t._v("POST")]),t._v("，"),s("code",[t._v("PUT")]),t._v("等方法")])]),t._v(" "),s("blockquote",[s("p",[t._v("前面提到的跨域手段都是某种意义上的"),s("code",[t._v("Hack")]),t._v("， "),s("code",[t._v("HTML5")]),t._v("标准中提出的跨域资源共享（"),s("code",[t._v("Cross Origin Resource Share")]),t._v("，"),s("code",[t._v("CORS")]),t._v("）才是正道。 它支持其他的"),s("code",[t._v("HTTP")]),t._v("方法如"),s("code",[t._v("PUT")]),t._v(", "),s("code",[t._v("POST")]),t._v("等，可以从本质上解决跨域问题。")])]),t._v(" "),s("ul",[s("li",[t._v("例如，从"),s("code",[t._v("http://a.com")]),t._v("要访问"),s("code",[t._v("http://b.com")]),t._v("的数据，通常情况下"),s("code",[t._v("Chrome")]),t._v("会因跨域请求而报错")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("XMLHttpRequest cannot load http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" No "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" header is present on the requested resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Origin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://a.com'")]),t._v(" is therefore not allowed access\n")])])]),s("ul",[s("li",[t._v("错误原因是被请求资源没有设置"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("，所以我们在"),s("code",[t._v("b.com")]),t._v("的服务器中设置这个响应头字段即可")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("Access"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("              # 允许所有域名访问，或者\nAccess"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com   # 只允许所有域名访问\n")])])]),s("h2",{attrs:{id:"六、window-postmessage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、window-postmessage"}},[t._v("#")]),t._v(" 六、window.postMessage")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("原理："),s("code",[t._v("HTML5")]),t._v("允许窗口之间发送消息")]),t._v(" "),s("li",[t._v("限制：浏览器需要支持"),s("code",[t._v("HTML5")]),t._v("，获取窗口句柄后才能相互通信")])]),t._v(" "),s("blockquote",[s("p",[t._v("这是一个安全的跨域通信方法，"),s("code",[t._v("postMessage(message,targetOrigin)")]),t._v("也是"),s("code",[t._v("HTML5")]),t._v("引入的特性。 可以给任何一个"),s("code",[t._v("window")]),t._v("发送消息，不论是否同源。第二个参数可以是*但如果你设置了一个"),s("code",[t._v("URL")]),t._v("但不相符，那么该事件不会被分发。看一个普通的使用方式吧")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL: http://a.com/foo")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" win "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.com/bar'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello, bar!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://b.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// URL: http://b.com/bar")]),t._v("\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"七、访问控制安全的讨论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、访问控制安全的讨论"}},[t._v("#")]),t._v(" 七、访问控制安全的讨论")]),t._v(" "),s("hr"),t._v(" "),s("ul",[s("li",[t._v("在"),s("code",[t._v("HTML5")]),t._v("之前，"),s("code",[t._v("JSONP")]),t._v("已经成为跨域的事实标准了，"),s("code",[t._v("jQuery")]),t._v("都给出了支持。 值得注意的是它只是"),s("code",[t._v("Hack")]),t._v("，并没有产生额外的安全问题。 因为"),s("code",[t._v("JSONP")]),t._v("要成功获取数据，需要跨域资源所在服务器的配合，比如资源所在服务器需要自愿地回调一个合适的函数，所以服务器仍然有能力控制资源的跨域访问")]),t._v(" "),s("li",[t._v("跨域的正道还是要使用"),s("code",[t._v("HTML5")]),t._v("提供的CORS头字段以及"),s("code",[t._v("window.postMessage")]),t._v("， 可以支持"),s("code",[t._v("POST")]),t._v(", "),s("code",[t._v("PUT")]),t._v("等"),s("code",[t._v("HTTP")]),t._v("方法，从机制上解决跨域问题。 值得注意的是"),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("头字段是资源所在服务器设置的， 访问控制的责任仍然是在提供资源的服务器一方，这和"),s("code",[t._v("JSONP")]),t._v("是一样的")])])])}),[],!1,null,null,null);a.default=e.exports}}]);