(window.webpackJsonp=window.webpackJsonp||[]).push([[299],{1416:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"一、koa框架介绍以及koa环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、koa框架介绍以及koa环境搭建"}},[t._v("#")]),t._v(" 一、Koa框架介绍以及Koa环境搭建")]),t._v(" "),a("h2",{attrs:{id:"_1-1-koa-框架介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-koa-框架介绍"}},[t._v("#")]),t._v(" 1.1 Koa 框架介绍")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("Node.js")]),t._v(" 是一个异步的世界，官方 "),a("code",[t._v("API")]),t._v(" 支持的都是 "),a("code",[t._v("callback")]),t._v(" 形式的异步编程模型，这 会带来许多问题，例如:")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("callback")]),t._v(" 嵌套问题")]),t._v(" "),a("li",[t._v("异步函数中可能同步调用 callback 返回 数据，带来不一致性。为了解决以上问题 "),a("code",[t._v("Koa")]),t._v(" 出现了")])]),t._v(" "),a("p",[a("strong",[t._v("Koa -- 基于 Node.js 平台的下一代 web 开发框架")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("koa")]),t._v(" 是由 "),a("code",[t._v("Express")]),t._v(" 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。 使用 "),a("code",[t._v("koa")]),t._v(" 编写 "),a("code",[t._v("web")]),t._v(" 应用，可以免除重复繁琐的回调函数嵌套， 并极大地提 升错误处理的效率。"),a("code",[t._v("koa")]),t._v(" 不在内核方法中绑定任何中间件， 它仅仅提供了一个轻量优雅的 函数库，使得编写 Web 应用变得得心应手。开发思路和 express 差不多，最大的特点就是 可以避免异步嵌套")])]),t._v(" "),a("h2",{attrs:{id:"_1-2-koa2-x-框架的安装使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-koa2-x-框架的安装使用"}},[t._v("#")]),t._v(" 1.2 Koa2.x 框架的安装使用")]),t._v(" "),a("p",[a("strong",[t._v("1. 安装 Node.js 8.x 以上的版本")])]),t._v(" "),a("blockquote",[a("p",[t._v("开发 "),a("code",[t._v("Koa2")]),t._v(" 之前，"),a("code",[t._v("Node.js")]),t._v(" 是有要求的，它要求 "),a("code",[t._v("Node.js")]),t._v(" 版本高于 "),a("code",[t._v("V7.6")]),t._v("。因为 "),a("code",[t._v("node.js 7.6")]),t._v(" 版本 开始完全支持 "),a("code",[t._v("async/await")]),t._v("，所以才能完全你支持我们的 Koa2`")])]),t._v(" "),a("p",[a("strong",[t._v("2. 安装 Koa")])]),t._v(" "),a("blockquote",[a("p",[t._v("安装 "),a("code",[t._v("Koa")]),t._v(" 框架和我们以前安装其他模块是一样的")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save koa / cnpm install --save koa\n")])])]),a("blockquote",[a("p",[a("code",[t._v("--save")]),t._v(" 参数，表示自动修改 "),a("code",[t._v("package.json")]),t._v(" 文件，自动添加依赖项")])]),t._v(" "),a("p",[a("strong",[t._v("简单使用")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/494.png",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"二、koa-路由-get传值、动态路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、koa-路由-get传值、动态路由"}},[t._v("#")]),t._v(" 二、koa 路由 get传值、动态路由")]),t._v(" "),a("h2",{attrs:{id:"_2-1-koa-路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-koa-路由"}},[t._v("#")]),t._v(" 2.1 Koa 路由")]),t._v(" "),a("ul",[a("li",[t._v("路由("),a("code",[t._v("Routing")]),t._v(")是由一个 "),a("code",[t._v("URI")]),t._v("(或者叫路径)和一个特定的 "),a("code",[t._v("HTTP")]),t._v(" 方法("),a("code",[t._v("GET")]),t._v("、"),a("code",[t._v("POST")]),t._v("等)\n组成的，涉及到应用如何响应客户端对某个网站节点的访问")]),t._v(" "),a("li",[t._v("通俗的讲:路由就是根据不同的 "),a("code",[t._v("URL")]),t._v(" 地址，加载不同的页面实现不同的功能")]),t._v(" "),a("li",[a("code",[t._v("Koa")]),t._v(" 中的路由和 "),a("code",[t._v("Express")]),t._v(" 有所不同，在 "),a("code",[t._v("Express")]),t._v(" 中直接引入 "),a("code",[t._v("Express")]),t._v(" 就可以配置路由，但是在 "),a("code",[t._v("Koa")]),t._v(" 中我们需要安装对应的 "),a("code",[t._v("koa-router")]),t._v(" 路由模块来实现")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save koa-router\n")])])]),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/495.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_2-2-koa-路由-get-传值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-koa-路由-get-传值"}},[t._v("#")]),t._v(" 2.2 Koa 路由 get 传值")]),t._v(" "),a("blockquote",[a("p",[t._v("在 "),a("code",[t._v("koa2")]),t._v(" 中 "),a("code",[t._v("GET")]),t._v(" 传值通过 "),a("code",[t._v("request")]),t._v(" 接收，但是接收的方法有两种:"),a("code",[t._v("query")]),t._v(" 和 "),a("code",[t._v("querystring")])])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("query")]),t._v(":返回的是格式化好的参数对象。")]),t._v(" "),a("li",[a("code",[t._v("querystring")]),t._v(":返回的是请求字符串")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/496.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_2-3-koa-动态路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-koa-动态路由"}},[t._v("#")]),t._v(" 2.3 Koa 动态路由")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/497.png",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"三、koa-中间件及执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、koa-中间件及执行流程"}},[t._v("#")]),t._v(" 三、koa 中间件及执行流程")]),t._v(" "),a("h2",{attrs:{id:"_3-1-koa中间件的洋葱图执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-koa中间件的洋葱图执行流程"}},[t._v("#")]),t._v(" 3.1 koa中间件的洋葱图执行流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/498.gif",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_3-2-koa-中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-koa-中间件"}},[t._v("#")]),t._v(" 3.2 koa 中间件")]),t._v(" "),a("h3",{attrs:{id:"_3-2-1-什么是-koa-的中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-什么是-koa-的中间件"}},[t._v("#")]),t._v(" 3.2.1 什么是 Koa 的中间件")]),t._v(" "),a("ul",[a("li",[t._v("通俗的讲:中间件就是匹配路由之前或者匹配路由完成做的一系列的操作，我们就可以\n把它叫做中间件")]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("express")]),t._v("中间件("),a("code",[t._v("Middleware")]),t._v(")是一个函数，它可以访问请求对象(request object (req)), 响应对象("),a("code",[t._v("response object (res)")]),t._v("), 和 "),a("code",[t._v("web")]),t._v(" 应用中处理请求-响应循环流程中的中间件，一 般被命名为 next 的变量。在 "),a("code",[t._v("Koa")]),t._v(" 中中间件和 "),a("code",[t._v("express")]),t._v(" 有点类似。")])]),t._v(" "),a("p",[a("strong",[t._v("中间件的功能包括")])]),t._v(" "),a("ul",[a("li",[t._v("执行任何代码")]),t._v(" "),a("li",[t._v("修改请求和响应对象")]),t._v(" "),a("li",[t._v("终结请求-响应循环")]),t._v(" "),a("li",[t._v("调用堆栈中的下一个中间件")])]),t._v(" "),a("blockquote",[a("p",[t._v("如果我的 "),a("code",[t._v("get")]),t._v("、"),a("code",[t._v("post")]),t._v(" 回调函数中，没有 "),a("code",[t._v("next")]),t._v(" 参数，那么就匹配上第一个路由，就不会往下匹 配了。如果想往下匹配的话，那么需要写 "),a("code",[t._v("next()")])])]),t._v(" "),a("h3",{attrs:{id:"_3-2-2-koa-应用可使用如下几种中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-koa-应用可使用如下几种中间件"}},[t._v("#")]),t._v(" 3.2.2 Koa 应用可使用如下几种中间件")]),t._v(" "),a("p",[a("strong",[t._v("1. 应用级中间件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/499.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("2. 路由中间件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/500.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("3. 错误处理中间件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/501.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("4. 第三方中间件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/502.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_3-2-3-koa-中间件的执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-koa-中间件的执行顺序"}},[t._v("#")]),t._v(" 3.2.3 Koa 中间件的执行顺序")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("Koa")]),t._v(" 的中间件和 "),a("code",[t._v("Express")]),t._v(" 不同，"),a("code",[t._v("Koa")]),t._v(" 选择了洋葱圈模型")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/503.png",alt:""}})]),t._v(" "),a("h1",{attrs:{id:"四、koa-ejs模板引擎使用-以及ejs配置全局数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、koa-ejs模板引擎使用-以及ejs配置全局数据"}},[t._v("#")]),t._v(" 四、koa ejs模板引擎使用 以及ejs配置全局数据")]),t._v(" "),a("p",[a("strong",[t._v("1. 安装 koa-views 和 ejs")])]),t._v(" "),a("ul",[a("li",[t._v("安装 "),a("code",[t._v("koa-views npm install --save koa-views / cnpm install --save koa-views")])]),t._v(" "),a("li",[t._v("安装 "),a("code",[t._v("ejs npm install ejs --save / cnpm install ejs --save")])])]),t._v(" "),a("p",[a("strong",[t._v("2. 引入 koa-views 配置中间件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" views "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-views'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("views")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'views'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ejs'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("3. Koa 中使用 ejs")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/add'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" title "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello koa2'")]),t._v(" \n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" title "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("4. Ejs 引入模板")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<%- include header.ejs %>\n")])])]),a("p",[a("strong",[t._v("5. Ejs 绑定数据")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<%=h%>\n")])])]),a("p",[a("strong",[t._v("6. Ejs 绑定 html 数据")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<%-h%>\n")])])]),a("p",[a("strong",[t._v("7. Ejs 模板判断语句")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("<% if(true){ %>\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n<%} else{ %>\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("false"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n<%} %>\n")])])]),a("p",[a("strong",[t._v("8. Ejs 模板中循环数据")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("<%for(var i=0;i"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("list.length;i++)")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%=list[i] %>"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n<%}%>\n")])])]),a("h1",{attrs:{id:"五、koa-post-提交数据-koa-bodyparser-中间件的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、koa-post-提交数据-koa-bodyparser-中间件的使用"}},[t._v("#")]),t._v(" 五、koa post 提交数据 koa-bodyparser 中间件的使用")]),t._v(" "),a("h2",{attrs:{id:"_5-1-原生-nodejs-获取-post-提交数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-原生-nodejs-获取-post-提交数据"}},[t._v("#")]),t._v(" 5.1 原生 Nodejs 获取 post 提交数据")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parsePostData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" postdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                postdata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" data\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"end"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("postdata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_5-2-koa-中-koa-bodyparser-中间件的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-koa-中-koa-bodyparser-中间件的使用"}},[t._v("#")]),t._v(" 5.2 Koa 中 koa-bodyparser 中间件的使用")]),t._v(" "),a("p",[a("strong",[t._v("1. 安装 koa-bodyparser")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save koa-bodyparser\n")])])]),a("p",[a("strong",[t._v("2. 安装 引入配置中间件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bodyParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-bodyparser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyParser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("strong",[t._v("3. 使用")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取 post 提交的数据")]),t._v("\n")])])]),a("h1",{attrs:{id:"六、koa-static静态资源中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、koa-static静态资源中间件"}},[t._v("#")]),t._v(" 六、koa-static静态资源中间件")]),t._v(" "),a("p",[a("strong",[t._v("1. 安装 koa-static")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save koa-static\n")])])]),a("p",[a("strong",[t._v("2. 引入配置中间件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-static'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" __dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'public'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h1",{attrs:{id:"七、koa-art-template高性能模板引擎的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、koa-art-template高性能模板引擎的使用"}},[t._v("#")]),t._v(" 七、koa art-template高性能模板引擎的使用")]),t._v(" "),a("h2",{attrs:{id:"_7-1-常见模板引擎的性能对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-常见模板引擎的性能对比"}},[t._v("#")]),t._v(" 7.1 常见模板引擎的性能对比")]),t._v(" "),a("blockquote",[a("p",[t._v("适用于 "),a("code",[t._v("koa")]),t._v(" 的模板引擎选择非常多，比如 "),a("code",[t._v("jade")]),t._v("、"),a("code",[t._v("ejs")]),t._v("、"),a("code",[t._v("nunjucks")]),t._v("、"),a("code",[t._v("art-template")]),t._v(" 等")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("art-template")]),t._v(" 是一个简约、超快的模板引擎")]),t._v(" "),a("li",[t._v("它采用作用域预声明的技术来优化模板渲染速度，从而获得接近 JavaScript 极限的运行 性能，并且同时支持 NodeJS 和浏览器。")]),t._v(" "),a("li",[a("code",[t._v("art-template")]),t._v(" 支持 "),a("code",[t._v("ejs")]),t._v(" 的语法，也可以用自己的类似 "),a("code",[t._v("angular")]),t._v(" 数据绑定的语法")]),t._v(" "),a("li",[t._v("中文文档: http://aui.github.io/art-template/zh-cn/docs")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/504.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/505.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_7-2-在-koa-中使用-art-template-模板引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-在-koa-中使用-art-template-模板引擎"}},[t._v("#")]),t._v(" 7.2 在 Koa 中使用 art-template 模板引擎")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" npm install --save art-template \n npm install --save koa-art-template\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" render "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-art-template'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'view'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    extname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.art'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_7-3-art-template-模板引擎语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-art-template-模板引擎语法"}},[t._v("#")]),t._v(" 7.3 art-template 模板引擎语法")]),t._v(" "),a("blockquote",[a("p",[t._v("参考:http://aui.github.io/art-template/zh-cn/docs/syntax.html")])]),t._v(" "),a("h1",{attrs:{id:"八、koa-cookie的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八、koa-cookie的使用"}},[t._v("#")]),t._v(" 八、koa Cookie的使用")]),t._v(" "),a("h2",{attrs:{id:"_8-1-koa-cookie-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-koa-cookie-的使用"}},[t._v("#")]),t._v(" 8.1 Koa Cookie 的使用")]),t._v(" "),a("p",[a("strong",[t._v("1. Koa 中设置 Cookie 的值")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("通过 "),a("code",[t._v("options")]),t._v(" 设置 "),a("code",[t._v("cookie name")]),t._v(" 的 "),a("code",[t._v("value")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/506.png",alt:""}})]),t._v(" "),a("p",[a("strong",[t._v("2. Koa 中获取 Cookie 的值")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookies"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"_8-2-koa-中设置中文-cookie"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-koa-中设置中文-cookie"}},[t._v("#")]),t._v(" 8.2 Koa 中设置中文 Cookie")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Buffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello, world!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'base64'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 转换成 base64 字符 串:aGVsbG8sIHdvcmxkIQ==")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Buffer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aGVsbG8sIHdvcmxkIQ=='")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'base64'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 还原 base 64 字符串:hello, world!")]),t._v("\n")])])]),a("h1",{attrs:{id:"九、koa-session-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九、koa-session-的使用"}},[t._v("#")]),t._v(" 九、koa Session 的使用")]),t._v(" "),a("h2",{attrs:{id:"_9-1-session-简单介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-session-简单介绍"}},[t._v("#")]),t._v(" 9.1 Session 简单介绍")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("session")]),t._v(" 是另一种记录客户状态的机制，不同的是 "),a("code",[t._v("Cookie")]),t._v(" 保存在客户端浏览器中，而 "),a("code",[t._v("session")]),t._v(" 保存在服务器上")])]),t._v(" "),a("h2",{attrs:{id:"_9-2-session-的工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-session-的工作流程"}},[t._v("#")]),t._v(" 9.2 Session 的工作流程")]),t._v(" "),a("blockquote",[a("p",[t._v("当浏览器访问服务器并发送第一次请求时，服务器端会创建一个 "),a("code",[t._v("session")]),t._v(" 对象，生 成一个类似于 "),a("code",[t._v("key")]),t._v(","),a("code",[t._v("value")]),t._v(" 的键值对， 然后将"),a("code",[t._v("key(cookie)")]),t._v("返回到浏览器(客户)端，浏览 器下次再访问时，携带 "),a("code",[t._v("key(cookie)")]),t._v("，找到对应的 "),a("code",[t._v("session(value)")]),t._v("。 客户的信息都保存 在 "),a("code",[t._v("session")]),t._v(" 中")])]),t._v(" "),a("h2",{attrs:{id:"_9-3-koa-session-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-koa-session-的使用"}},[t._v("#")]),t._v(" 9.3 koa-session 的使用")]),t._v(" "),a("p",[a("strong",[t._v("1. 安装 express-session")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install koa-session --save\n")])])]),a("p",[a("strong",[t._v("2. 引入 express-session")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const session = require('koa-session');\n")])])]),a("p",[a("strong",[t._v("3. 设置官方文档提供的中间件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'some secret hurr'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa:sess'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cookie key (default is koa:sess)")]),t._v("\n    maxAge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("86400000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// cookie 的过期时间 maxAge in ms (default is 1 days)")]),t._v("\n    overwrite"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//是否可以 overwrite (默认 default true)")]),t._v("\n    httpOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cookie 是否只有服务器端可以访问 httpOnly or not (default true)")]),t._v("\n    signed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//签名默认 true")]),t._v("\n    rolling"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在每次请求时强行设置cookie，这将重置cookie过期时间(默认:false)")]),t._v("\n    renew"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(boolean) renew session when session is nearly expired")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("session")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CONFIG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("strong",[t._v("4. 使用")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置值 ")]),t._v("\nctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取值 ")]),t._v("\nctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username\n")])])]),a("h2",{attrs:{id:"_9-4-cookie-和-session-区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-cookie-和-session-区别"}},[t._v("#")]),t._v(" 9.4 Cookie 和 Session 区别")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("cookie")]),t._v(" 数据存放在客户的浏览器上，"),a("code",[t._v("session")]),t._v(" 数据放在服务器上")]),t._v(" "),a("li",[a("code",[t._v("cookie")]),t._v(" 不是很安全，别人可以分析存放在本地的 "),a("code",[t._v("COOKIE")]),t._v(" 并进行 "),a("code",[t._v("COOKIE")]),t._v(" 欺骗 考虑到安全应当使用 "),a("code",[t._v("session")])]),t._v(" "),a("li",[a("code",[t._v("session")]),t._v("会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能 考虑到减轻服务器性能方面，应当使用 "),a("code",[t._v("COOKIE")])]),t._v(" "),a("li",[t._v("单个 "),a("code",[t._v("cookie")]),t._v(" 保存的数据不能超过 "),a("code",[t._v("4K")]),t._v("，很多浏览器都限制一个站点最多保存 "),a("code",[t._v("20")]),t._v(" 个 "),a("code",[t._v("cookie")])])]),t._v(" "),a("h1",{attrs:{id:"十、koa-操作-mongodb-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十、koa-操作-mongodb-数据库"}},[t._v("#")]),t._v(" 十、Koa 操作 Mongodb 数据库")]),t._v(" "),a("blockquote",[a("p",[t._v("官方文档:http://mongodb.github.io/node-mongodb-native/")])]),t._v(" "),a("h1",{attrs:{id:"十一、koa-应用生成器以及-koa-路由模-块化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#十一、koa-应用生成器以及-koa-路由模-块化"}},[t._v("#")]),t._v(" 十一、Koa 应用生成器以及 Koa 路由模 块化")]),t._v(" "),a("h2",{attrs:{id:"_11-1-koa-应用生成器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-1-koa-应用生成器"}},[t._v("#")]),t._v(" 11.1 koa 应用生成器")]),t._v(" "),a("blockquote",[a("p",[t._v("通过应用 "),a("code",[t._v("koa")]),t._v(" 脚手架生成工具 可以快速创建一个基于 "),a("code",[t._v("koa2")]),t._v(" 的应用的骨架")])]),t._v(" "),a("p",[a("strong",[t._v("1. 全局安装")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install koa-generator -g\n")])])]),a("p",[a("strong",[t._v("2. 创建项目")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("koa koa_demo\n")])])]),a("p",[a("strong",[t._v("3. 安装依赖")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd koa_demo\n\nnpm install\n")])])]),a("p",[a("strong",[t._v("4. 启动项目")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm start\n")])])]),a("h2",{attrs:{id:"_11-2-koa-搭建模块化路由-层级路由"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-2-koa-搭建模块化路由-层级路由"}},[t._v("#")]),t._v(" 11.2 koa 搭建模块化路由/层级路由")]),t._v(" "),a("ol",[a("li",[t._v("在目录下面新建一个文件夹 "),a("code",[t._v("routes")])]),t._v(" "),a("li",[t._v("在 "),a("code",[t._v("routes")]),t._v(" 里面配置对应的子页面")]),t._v(" "),a("li",[t._v("比如在 "),a("code",[t._v("routes")]),t._v(" 新建 "),a("code",[t._v("index.js")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/507.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("然后在主应用中加载子路由模块:")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/508.png",alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);