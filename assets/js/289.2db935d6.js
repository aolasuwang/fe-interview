(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{846:function(a,e,s){"use strict";s.r(e);var t=s(10),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"一、下载node镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、下载node镜像"}},[a._v("#")]),a._v(" 一、下载node镜像")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker pull node\n")])])]),s("p",[a._v("下载完后"),s("code",[a._v("docker images")]),a._v("查看一下，稍后用到")]),a._v(" "),s("h2",{attrs:{id:"二、创建dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、创建dockerfile"}},[a._v("#")]),a._v(" 二、创建Dockerfile")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("FROM node\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" -p /home/Service\nWORKDIR /home/Service    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Bundle app source")]),a._v("\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" /home/Service\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" start   \n "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## 如果想运行多条指令可以这样：")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## CMD git pull && npm install && npm start")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-1-from"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-from"}},[a._v("#")]),a._v(" 2.1 FROM")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("FROM node\n")])])]),s("blockquote",[s("p",[s("code",[a._v("FROM")]),a._v("是构建镜像的基础源镜像，"),s("code",[a._v("node")]),a._v(" 这个是镜像的名称，也就是我们一开始从国内服务器上拉下来的那个"),s("code",[a._v("Image")]),a._v("。如果本地没有"),s("code",[a._v("Docker")]),a._v(" 会自己"),s("code",[a._v("pull")]),a._v("镜像")])]),a._v(" "),s("h3",{attrs:{id:"_2-2-run"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-run"}},[a._v("#")]),a._v(" 2.2 RUN")]),a._v(" "),s("p",[a._v("后面跟的是在这个新容器中执行的命令")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在容器中创建一个目录")]),a._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" -p /home/Service\n")])])]),s("h3",{attrs:{id:"_2-3-workdir"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-workdir"}},[a._v("#")]),a._v(" 2.3 WORKDIR")]),a._v(" "),s("p",[a._v("容器的工作目录")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#将容器的工作目录定位到 /home/Service中")]),a._v("\nWORKDIR /home/Service\n")])])]),s("h3",{attrs:{id:"_2-4-copy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-copy"}},[a._v("#")]),a._v(" 2.4 COPY")]),a._v(" "),s("p",[a._v("将本地的东西拷贝到容器的指定目录下")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#把本机当前目录下的所有文件拷贝到Image的/home/Service文件夹下")]),a._v("\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" /home/Service  \nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-5-expose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-expose"}},[a._v("#")]),a._v(" 2.5 EXPOSE")]),a._v(" "),s("p",[a._v("将容器内的某个端口导出给主机，用于我们访问")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("EXPOSE 8888\n")])])]),s("h3",{attrs:{id:"_2-6-cmd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-cmd"}},[a._v("#")]),a._v(" 2.6 CMD")]),a._v(" "),s("ul",[s("li",[a._v("首先：每个"),s("code",[a._v("Dockerfile")]),a._v("中只能写一个"),s("code",[a._v("CMD")]),a._v("，写多了，后面的会覆盖前面的。")]),a._v(" "),s("li",[a._v("然后："),s("code",[a._v("CMD")]),a._v("后面跟的命令是每次容器启动的时候执行的命令。")]),a._v(" "),s("li",[a._v('最后：命令格式可以是数组格式，也可是直接命令行方式，多条命令的时候用 "'),s("code",[a._v("&&")]),a._v('"链接。')])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('CMD [ "npm", "start" ]\n')])])]),s("h2",{attrs:{id:"三、构建image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、构建image"}},[a._v("#")]),a._v(" 三、构建Image")]),a._v(" "),s("blockquote",[s("p",[a._v("在你"),s("code",[a._v("Dockerfile")]),a._v("文件所在的目录下运行下面的命令来构建一个"),s("code",[a._v("Image")])])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker build -t mynodeapp .\n")])])]),s("blockquote",[s("p",[a._v("点就是指当前目录下的"),s("code",[a._v("Dockerfile")])])]),a._v(" "),s("p",[a._v("构建完后查看一下我们的镜像")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/20191001/42.png",alt:""}})]),a._v(" "),s("p",[s("strong",[a._v("运行镜像")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker run -d -p 8880:8888 mynodeapp\n")])])]),s("ul",[s("li",[s("code",[a._v("-d")]),a._v(" :表明容器会在后台运行，")]),a._v(" "),s("li",[s("code",[a._v("-p")]),a._v(" :表示端口映射，把本机的"),s("code",[a._v("8880")]),a._v("端口映射到"),s("code",[a._v("container")]),a._v("的"),s("code",[a._v("8888")]),a._v("端口，这样外网就能通过本机的"),s("code",[a._v("8880")]),a._v("端口访问我们的"),s("code",[a._v("web")]),a._v("了。")]),a._v(" "),s("li",[a._v("后面的"),s("code",[a._v("mynodeapp")]),a._v("是我们镜像的名字")])]),a._v(" "),s("blockquote",[s("p",[a._v("通过"),s("code",[a._v("docker ps")]),a._v(" 查看我们刚运行的"),s("code",[a._v("Container")]),a._v("的"),s("code",[a._v("ID")])])]),a._v(" "),s("p",[a._v("我们先通过"),s("code",[a._v("curl")]),a._v(" 看能不能访问我们的"),s("code",[a._v("web")]),a._v("。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("curl -i localhost:8880\n")])])]),s("p",[a._v("如果返回相应的HTTP信息，表示成功")]),a._v(" "),s("h2",{attrs:{id:"四、结合pm2部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、结合pm2部署"}},[a._v("#")]),a._v(" 四、结合pm2部署")]),a._v(" "),s("blockquote",[s("p",[a._v("部署参考 http://blog.poetries.top/2018/11/18/react-ssr-next-deploy/")])]),a._v(" "),s("blockquote",[s("p",[a._v("使用命令"),s("code",[a._v("pm2 start app.js")]),a._v(" 之后, "),s("code",[a._v("pm2")]),a._v(" 默认在后台运行, 如果使用了"),s("code",[a._v("Docker")]),a._v("后,容器运行并立即退出,需要手动给“"),s("code",[a._v("pm2")]),a._v("”指定参数 "),s("code",[a._v("--no-daemon")])])]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在Dockerfile中：")]),a._v("\n\n--no-daemon // run pm2 daemon "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" the foreground "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" it doesn't exist already\n\nCMD pm2 start app.js --no-daemon // 设置启动方式\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  或者 使用   pm2-docker")]),a._v("\nCMD pm2-docker start app.js\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);