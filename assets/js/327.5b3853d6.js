(window.webpackJsonp=window.webpackJsonp||[]).push([[327],{879:function(e,t,v){"use strict";v.r(t);var _=v(10),o=Object(_.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h2",{attrs:{id:"一、重新认识render"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一、重新认识render"}},[e._v("#")]),e._v(" 一、重新认识render")]),e._v(" "),v("blockquote",[v("p",[v("code",[e._v("react")]),e._v("的组件渲染分为初始化渲染和更新渲染")])]),e._v(" "),v("ul",[v("li",[e._v("在初始化渲染的时候会调用根组件下的所有组件的"),v("code",[e._v("render")]),e._v("方法进行渲染，如下图（绿色表示已渲染，这一层是没有问题的）")])]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/420.png",alt:""}})]),e._v(" "),v("p",[e._v("但是当我们要更新某个子组件的时候，如下图的绿色组件（从根组件传递下来应用在绿色组件上的数据发生改变）")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/421.png",alt:""}})]),e._v(" "),v("p",[e._v("我们的理想状态是只调用关键路径上组件的render")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/422.png",alt:""}})]),e._v(" "),v("p",[e._v("但是"),v("code",[e._v("react")]),e._v("的默认做法是调用所有组件的"),v("code",[e._v("render")]),e._v("，再对生成的虚拟"),v("code",[e._v("DOM")]),e._v("进行对比，如不变则不进行更新。这样的"),v("code",[e._v("render")]),e._v("和虚拟"),v("code",[e._v("DOM")]),e._v("的 对比 明显是在浪费，如下图（黄色表示浪费的"),v("code",[e._v("render")]),e._v("和虚拟"),v("code",[e._v("DOM")]),e._v("对比）")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/423.png",alt:""}})]),e._v(" "),v("p",[v("strong",[e._v("Tips")])]),e._v(" "),v("ul",[v("li",[e._v("拆分组件是有利于复用和组件优化的")]),e._v(" "),v("li",[e._v("生成虚拟"),v("code",[e._v("DOM")]),e._v("并进行比对发生在"),v("code",[e._v("render()")]),e._v("后，而不是"),v("code",[e._v("render()")]),e._v("前")])]),e._v(" "),v("h2",{attrs:{id:"二、更新阶段的生命周期"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#二、更新阶段的生命周期"}},[e._v("#")]),e._v(" 二、更新阶段的生命周期")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("componentWillReceiveProps(object nextProps)")]),e._v(" ：当挂载的组件接收到新的"),v("code",[e._v("props")]),e._v("时被调用。此方法应该被用于比较"),v("code",[e._v("this.props")]),e._v(" 和 "),v("code",[e._v("nextProps")]),e._v("以用于使用"),v("code",[e._v("this.setState()")]),e._v("执行状态转换。（组件内部数据有变化，使用"),v("code",[e._v("state")]),e._v("，但是在更新阶段又要在"),v("code",[e._v("props")]),e._v("改变的时候改变"),v("code",[e._v("state")]),e._v("，则在这个生命周期里面）")]),e._v(" "),v("li",[v("code",[e._v("shouldComponentUpdate(object nextProps, object nextState)")]),e._v(" ： -"),v("code",[e._v("boolean")]),e._v(" 当组件决定任何改变是否要更新到"),v("code",[e._v("DOM")]),e._v("时被调用。作为一个 优化 实现比较"),v("code",[e._v("this.props")]),e._v(" 和 "),v("code",[e._v("nextProps")]),e._v(" 、"),v("code",[e._v("this.state")]),e._v(" 和 "),v("code",[e._v("nextState")]),e._v(" ，如果"),v("code",[e._v("React")]),e._v("应该跳过更新，返回"),v("code",[e._v("false")])]),e._v(" "),v("li",[v("code",[e._v("componentWillUpdate(object nextProps, object nextState")]),e._v(") ：在更新发生前被立即调用。你不能在此调用 "),v("code",[e._v("this.setState()")])]),e._v(" "),v("li",[v("code",[e._v("componentDidUpdate(object prevProps, object prevState")]),e._v(") ： 在更新发生后被立即调用。（可以在"),v("code",[e._v("DOM")]),e._v("更新完之后，做一些收尾的工作）")])]),e._v(" "),v("p",[v("strong",[e._v("Tips")])]),e._v(" "),v("ul",[v("li",[v("code",[e._v("React")]),e._v("的优化是基于 "),v("code",[e._v("shouldComponentUpdate")]),e._v(" 的，该生命周期默认返回"),v("code",[e._v("true")]),e._v("，所以一旦"),v("code",[e._v("prop")]),e._v("或"),v("code",[e._v("state")]),e._v("有任何变化，都会引起重新"),v("code",[e._v("render")])])]),e._v(" "),v("h2",{attrs:{id:"三、shouldcomponentupdate"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#三、shouldcomponentupdate"}},[e._v("#")]),e._v(" 三、shouldComponentUpdate")]),e._v(" "),v("blockquote",[v("p",[v("code",[e._v("react")]),e._v("在每个组件生命周期更新的时候都会调用一个"),v("code",[e._v("shouldComponentUpdate(nextProps, nextState)")]),e._v("函数。它的职责就是返回"),v("code",[e._v("true")]),e._v("或"),v("code",[e._v("false")]),e._v("，true表示需要更新，"),v("code",[e._v("false")]),e._v("表示不需要，默认返回为"),v("code",[e._v("true")]),e._v("，即便你没有显示地定义 "),v("code",[e._v("shouldComponentUpdate")]),e._v(" 函数。这就不难解释上面发生的资源浪费了")])]),e._v(" "),v("p",[v("strong",[e._v("带坑的写法")])]),e._v(" "),v("ul",[v("li",[v("code",[e._v("{...this.props}")]),e._v(" (不要滥用，请只传递"),v("code",[e._v("component")]),e._v("需要的"),v("code",[e._v("props")]),e._v("，传得太多，或者层次传得太深，都会加重"),v("code",[e._v("shouldComponentUpdate")]),e._v("里面的数据比较负担，因此，也请慎用"),v("code",[e._v("spread attributes（<Component {...props} />）)")])]),e._v(" "),v("li",[v("code",[e._v("::this.handleChange()。(请将方法的bind一律置于constructor)")])]),e._v(" "),v("li",[e._v("复杂的页面不要在一个组件里面写完")]),e._v(" "),v("li",[e._v("请尽量使用"),v("code",[e._v("const element")])]),e._v(" "),v("li",[v("code",[e._v("map")]),e._v("里面添加"),v("code",[e._v("key")]),e._v("，并且"),v("code",[e._v("key")]),e._v("不要使用"),v("code",[e._v("index")]),e._v("（可变的)")]),e._v(" "),v("li",[e._v("尽量少用"),v("code",[e._v("setTimeOut")]),e._v("或不可控的"),v("code",[e._v("refs")]),e._v("、"),v("code",[e._v("DOM")]),e._v("操作")]),e._v(" "),v("li",[e._v("数据尽可能简单明了，扁平化")])]),e._v(" "),v("h2",{attrs:{id:"四、性能检测工具"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#四、性能检测工具"}},[e._v("#")]),e._v(" 四、性能检测工具")]),e._v(" "),v("p",[v("strong",[e._v("React.addons.Perf")])]),e._v(" "),v("blockquote",[v("p",[v("code",[e._v("react")]),e._v("官方提供一个插件 "),v("code",[e._v("React.addons.Perf")]),e._v(" 可以帮助我们分析组件的性能，以确定是否需要优化")])]),e._v(" "),v("p",[v("code",[e._v("react16")]),e._v("以前需要在项目中配置，"),v("code",[e._v("react16")]),e._v("以后请看这篇文章，直接打开控制台的"),v("code",[e._v("perf")]),e._v("选项测试 https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab")]),e._v(" "),v("p",[v("strong",[e._v("react16之前配置")])]),e._v(" "),v("ul",[v("li",[e._v("安装 "),v("code",[e._v("react")]),e._v(" 性能检测工具 "),v("code",[e._v("npm i react-addons-perf --save")]),e._v("，然后在"),v("code",[e._v("./app/index.js")]),e._v("中")])]),e._v(" "),v("div",{staticClass:"language-javascript extra-class"},[v("pre",{pre:!0,attrs:{class:"language-javascript"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 性能测试")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" Perf "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[e._v("'react-addons-perf'")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("__DEV__"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    window"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Perf "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" Perf\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),v("ul",[v("li",[e._v("打开"),v("code",[e._v("console")]),e._v("面板，先输入 "),v("code",[e._v("Perf.start()")]),e._v(" 执行一些组件操作，引起数据变动，组件更新，然后输入 "),v("code",[e._v("Perf.stop()")]),e._v(" 。（建议一次只执行一个操作，好进行分析）")]),e._v(" "),v("li",[e._v("再输入 "),v("code",[e._v("Perf.printInclusive")]),e._v(" 查看所有涉及到的组件"),v("code",[e._v("render")]),e._v("，如下图（官方图片）")])]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/424.png",alt:""}})]),e._v(" "),v("blockquote",[v("p",[e._v("或者输入"),v("code",[e._v("Perf.printWasted()")]),e._v("查看下不需要的的浪费组件"),v("code",[e._v("render")])])]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/425.png",alt:""}})]),e._v(" "),v("p",[e._v("优化前")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/426.png",alt:""}})]),e._v(" "),v("p",[e._v("优化后")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://poetries1.gitee.io/img-repo/2019/10/427.png",alt:""}})]),e._v(" "),v("h2",{attrs:{id:"五、参考文章"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#五、参考文章"}},[e._v("#")]),e._v(" 五、参考文章")]),e._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://reactjs.org/docs/optimizing-performance.html#profiling-components-with-the-chrome-performance-tab",target:"_blank",rel:"noopener noreferrer"}},[e._v("react官方的性能优化optimizing-performance"),v("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=o.exports}}]);